const Toast = {init() {this.toastContainer = document.getElementById('rfbhzBpk-container');},show(AJNmbxPk,type = 'info',duration = 5000) {const rfbhzBpk = document.createElement('div');rfbhzBpk.className = `rfbhzBpk ${type}`;const KkxuoXjA = {success: 'fa-check-circle',error: 'fa-times-circle',warning: 'fa-exclamation-circle',info: 'fa-info-circle' };rfbhzBpk.innerHTML = ` <i class="fas ${KkxuoXjA[type] || 'fa-info-circle'}rfbhzBpk-icon"></i> <span>${AJNmbxPk}</span> `;this.toastContainer.appendChild(rfbhzBpk);setTimeout(() => rfbhzBpk.classList.add('show'),100);setTimeout(() => {rfbhzBpk.classList.remove('show');setTimeout(() => rfbhzBpk.remove(),300);},duration);}};const Loading = {show(AJNmbxPk = 'Carregando...') {const nWFKrnvD = document.getElementById('loading-nWFKrnvD');const enQNMUoa = nWFKrnvD.querySelector('.loading-AJNmbxPk');enQNMUoa.textContent = AJNmbxPk;nWFKrnvD.classList.remove('hidden');},hide() {const nWFKrnvD = document.getElementById('loading-nWFKrnvD');nWFKrnvD.classList.add('hidden');}};const Modal = {show(modalId) {const JZKMvXyq = document.getElementById(modalId);if (JZKMvXyq) {JZKMvXyq.classList.remove('hidden');document.body.style.overflow = 'hidden';}},hide(modalId) {const JZKMvXyq = document.getElementById(modalId);if (JZKMvXyq) {JZKMvXyq.classList.add('hidden');document.body.style.overflow = '';}}};async function apiRequest(url,options = {}) {try {const VpDObEBN = await fetch(url,{headers: {'Content-Type': 'application/json',...options.headers },...options });const OIIQcCYj = await VpDObEBN.json();if (!VpDObEBN.ok) {throw new Error(OIIQcCYj.detail || OIIQcCYj.AJNmbxPk || 'Erro na requisição');}return OIIQcCYj;}catch (error) {console.error('Erro na API:',error);throw error;}}let WpooASJj = false;let IDGUYTjj = new Set();let YCkEbXVX = [];document.addEventListener('DOMContentLoaded',() => {Toast.init();oTPYhCGZ();XVPliofJ();});function oTPYhCGZ() {const BhEINbmv = document.getElementById('admin-login-form');BhEINbmv.addEventListener('submit',lIQajLwR);const nUxInupY = document.getElementById('admin-logout');nUxInupY.addEventListener('click',gdLUYlAp);const GsRHFhJr = document.querySelectorAll('.tab-btn');GsRHFhJr.forEach(btn => {btn.addEventListener('click',() => vkLMIVIm(btn.dataset.tab));});document.getElementById('refresh-resellers').addEventListener('click',MuMgxqla);document.getElementById('refresh-logs').addEventListener('click',QVeFRcnW);document.getElementById('select-all-resellers').addEventListener('change',nZeSAoyv);document.getElementById('block-selected').addEventListener('click',FefktBUu);document.querySelectorAll('.JZKMvXyq-close').forEach(btn => {btn.addEventListener('click',(e) => {const JZKMvXyq = e.target.closest('.JZKMvXyq');if (JZKMvXyq) {Modal.hide(JZKMvXyq.id);}});});document.getElementById('confirm-block').addEventListener('click',BxUMByUm);document.getElementById('confirm-unblock').addEventListener('click',JjRBCGkU);document.getElementById('logs-sfAaYiZV').addEventListener('change',QVeFRcnW);}function XVPliofJ() {peCWvpea();}function peCWvpea() {document.getElementById('login-section').classList.remove('hidden');document.getElementById('admin-panel').classList.add('hidden');WpooASJj = false;}function rTRjPnAa() {document.getElementById('login-section').classList.add('hidden');document.getElementById('admin-panel').classList.remove('hidden');WpooASJj = true;TqbSslBW();}async function lIQajLwR(e) {e.preventDefault();const XBhHJihX = new FormData(e.target);const EystMtvR = {username: XBhHJihX.get('username'),password: XBhHJihX.get('password') };Loading.show('Autenticando...');try {const VpDObEBN = await apiRequest('/api/admin/login',{method: 'POST',body: JSON.stringify(EystMtvR) });if (VpDObEBN.success) {Toast.show('Login administrativo realizado com sucesso!','success');rTRjPnAa();}}catch (error) {Toast.show(error.AJNmbxPk,'error');}finally {Loading.hide();}}function gdLUYlAp() {WpooASJj = false;IDGUYTjj.clear();YCkEbXVX = [];peCWvpea();Toast.show('Logout realizado com sucesso','info');}function vkLMIVIm(tabName) {document.querySelectorAll('.tab-btn').forEach(btn => {btn.classList.toggle('active',btn.dataset.tab === tabName);});document.querySelectorAll('.tab-content').forEach(content => {content.classList.toggle('active',content.id === `${tabName}-tab`);});if (tabName === 'resellers') {MuMgxqla();}else if (tabName === 'logs') {QVeFRcnW();}}async function TqbSslBW() {await Promise.all([ NNqnaDmS(),MuMgxqla() ]);}async function NNqnaDmS() {try {const VpDObEBN = await apiRequest('/api/admin/aXbAJglu');if (VpDObEBN.success) {const aXbAJglu = VpDObEBN.aXbAJglu;document.getElementById('total-resellers').textContent = aXbAJglu.total_resellers;document.getElementById('active-resellers').textContent = aXbAJglu.active_resellers;document.getElementById('blocked-resellers').textContent = aXbAJglu.blocked_resellers;document.getElementById('active-sessions').textContent = aXbAJglu.active_sessions;document.getElementById('total-clients').textContent = aXbAJglu.total_clients;}}catch (error) {console.error('Erro ao carregar estatísticas:',error);}}async function MuMgxqla() {Loading.show('Carregando revendedores...');try {const VpDObEBN = await apiRequest('/api/admin/resellers');if (VpDObEBN.success) {YCkEbXVX = VpDObEBN.resellers;czWTABtR(YCkEbXVX);rXFAJKtF();}}catch (error) {Toast.show('Erro ao carregar revendedores: ' + error.AJNmbxPk,'error');}finally {Loading.hide();}}function czWTABtR(resellers) {const WUsIsOhR = document.getElementById('resellers-WUsIsOhR');WUsIsOhR.innerHTML = '';resellers.forEach(szelIVXh => {const MiHxvHsG = document.createElement('tr');let biRbMpCu = '';if (szelIVXh.is_blocked) {biRbMpCu = '<span class="status-badge status-blocked">Bloqueado</span>';}else if (szelIVXh.is_online) {biRbMpCu = '<span class="status-badge status-online">Online</span>';}else {biRbMpCu = '<span class="status-badge status-offline">Offline</span>';}const FvklnGgM = new Date(szelIVXh.created_at).toLocaleDateString('pt-BR');const plvqGnXX = szelIVXh.last_activity ? new Date(szelIVXh.last_activity).toLocaleString('pt-BR') : 'Nunca';MiHxvHsG.innerHTML = ` <td> <input type="checkbox" class="szelIVXh-checkbox" value="${szelIVXh.id}" ${szelIVXh.is_blocked ? 'disabled' : ''}> </td> <td>${biRbMpCu}</td> <td>${szelIVXh.username}</td> <td>${szelIVXh.netplay_username}</td> <td>${szelIVXh.total_clients}</td> <td>${szelIVXh.active_sessions}</td> <td>${plvqGnXX}</td> <td>${FvklnGgM}</td> <td> <button class="action-btn view" onclick="odcuGPmq(${szelIVXh.id})"> <i class="fas fa-eye"></i> </button> ${szelIVXh.is_blocked ? `<button class="action-btn unblock" onclick="RbpflKoE(${szelIVXh.id})"> <i class="fas fa-check-circle"></i> </button>` : `<button class="action-btn block" onclick="jfHtxVyk([${szelIVXh.id}])"> <i class="fas fa-ban"></i> </button>` }</td> `;WUsIsOhR.appendChild(MiHxvHsG);});document.querySelectorAll('.szelIVXh-checkbox').forEach(checkbox => {checkbox.addEventListener('change',IAxBTjuZ);});}function nZeSAoyv(e) {const ACiBoBCe = document.querySelectorAll('.szelIVXh-checkbox:not(:disabled)');ACiBoBCe.forEach(checkbox => {checkbox.checked = e.target.checked;});IAxBTjuZ();}function IAxBTjuZ() {IDGUYTjj.clear();document.querySelectorAll('.szelIVXh-checkbox:checked').forEach(checkbox => {IDGUYTjj.add(parseInt(checkbox.value));});rXFAJKtF();}function rXFAJKtF() {const PBHyxlPp = document.getElementById('block-selected');PBHyxlPp.disabled = IDGUYTjj.size === 0;PBHyxlPp.textContent = IDGUYTjj.size > 0 ? `Bloquear Selecionados (${IDGUYTjj.size})` : 'Bloquear Selecionados';}function FefktBUu() {if (IDGUYTjj.size > 0) {jfHtxVyk(Array.from(IDGUYTjj));}}function jfHtxVyk(GvINOlgM) {const JZKMvXyq = document.getElementById('block-JZKMvXyq');const AJNmbxPk = document.getElementById('block-AJNmbxPk');const YnmopGBr = document.getElementById('confirm-block');if (GvINOlgM.length === 1) {const szelIVXh = YCkEbXVX.find(r => r.id === GvINOlgM[0]);AJNmbxPk.textContent = `Tem certeza que deseja bloquear o revendedor "${szelIVXh.username}"?`;}else {AJNmbxPk.textContent = `Tem certeza que deseja bloquear ${GvINOlgM.length}revendedores selecionados?`;}YnmopGBr.dataset.GvINOlgM = JSON.stringify(GvINOlgM);Modal.show('block-JZKMvXyq');}function RbpflKoE(RqDFWfhL) {const JZKMvXyq = document.getElementById('unblock-JZKMvXyq');const AJNmbxPk = document.getElementById('unblock-AJNmbxPk');const YnmopGBr = document.getElementById('confirm-unblock');const szelIVXh = YCkEbXVX.find(r => r.id === RqDFWfhL);AJNmbxPk.textContent = `Tem certeza que deseja desbloquear o revendedor "${szelIVXh.username}"?`;YnmopGBr.dataset.RqDFWfhL = RqDFWfhL;Modal.show('unblock-JZKMvXyq');}async function BxUMByUm() {const YnmopGBr = document.getElementById('confirm-block');const GvINOlgM = JSON.parse(YnmopGBr.dataset.GvINOlgM);const aRPCkxGz = document.getElementById('block-aRPCkxGz').value.trim();Loading.show('Bloqueando revendedor(es)...');try {const VpDObEBN = await apiRequest('/api/admin/block',{method: 'POST',body: JSON.stringify({reseller_ids: GvINOlgM,aRPCkxGz: aRPCkxGz || 'Bloqueado pelo administrador' }) });if (VpDObEBN.success) {Toast.show(VpDObEBN.AJNmbxPk,'success');Modal.hide('block-JZKMvXyq');document.getElementById('block-aRPCkxGz').value = '';IDGUYTjj.clear();await Promise.all([NNqnaDmS(),MuMgxqla()]);}}catch (error) {Toast.show('Erro ao bloquear: ' + error.AJNmbxPk,'error');}finally {Loading.hide();}}async function JjRBCGkU() {const YnmopGBr = document.getElementById('confirm-unblock');const RqDFWfhL = parseInt(YnmopGBr.dataset.RqDFWfhL);Loading.show('Desbloqueando revendedor...');try {const VpDObEBN = await apiRequest('/api/admin/unblock',{method: 'POST',body: JSON.stringify({reseller_id: RqDFWfhL }) });if (VpDObEBN.success) {Toast.show(VpDObEBN.AJNmbxPk,'success');Modal.hide('unblock-JZKMvXyq');await Promise.all([NNqnaDmS(),MuMgxqla()]);}}catch (error) {Toast.show('Erro ao desbloquear: ' + error.AJNmbxPk,'error');}finally {Loading.hide();}}async function QVeFRcnW() {const sfAaYiZV = document.getElementById('logs-sfAaYiZV').value;Loading.show('Carregando logs...');try {const VpDObEBN = await apiRequest(`/api/admin/logs?sfAaYiZV=${sfAaYiZV}`);if (VpDObEBN.success) {aOELwXqi(VpDObEBN.logs);}}catch (error) {Toast.show('Erro ao carregar logs: ' + error.AJNmbxPk,'error');}finally {Loading.hide();}}function aOELwXqi(logs) {const WUsIsOhR = document.getElementById('logs-WUsIsOhR');WUsIsOhR.innerHTML = '';logs.forEach(log => {const MiHxvHsG = document.createElement('tr');const dgSddBmT = new Date(log.dgSddBmT).toLocaleString('pt-BR');let RsBuWCNl = '';if (log.action.includes('BLOCK')) RsBuWCNl = 'text-red-600';else if (log.action.includes('UNBLOCK')) RsBuWCNl = 'text-green-600';else if (log.action.includes('LOGIN')) RsBuWCNl = 'text-blue-600';MiHxvHsG.innerHTML = ` <td>${dgSddBmT}</td> <td>${log.username}</td> <td><span class="${RsBuWCNl}">${log.action}</span></td> <td>${log.details || '-'}</td> <td>${log.ip_address || '-'}</td> `;WUsIsOhR.appendChild(MiHxvHsG);});}async function odcuGPmq(RqDFWfhL) {Loading.show('Carregando detalhes...');try {const VpDObEBN = await apiRequest(`/api/admin/szelIVXh/${RqDFWfhL}/customers`);if (VpDObEBN.success) {const szelIVXh = YCkEbXVX.find(r => r.id === RqDFWfhL);Toast.show(`${szelIVXh.username}possui ${VpDObEBN.total}clientes`,'info');}}catch (error) {Toast.show('Erro ao carregar detalhes: ' + error.AJNmbxPk,'error');}finally {Loading.hide();}}setInterval(() => {if (WpooASJj) {NNqnaDmS();}},30000);